<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lead Visibility Groups - Testing</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      h1 {
        color: #333;
        text-align: center;
      }
      h2 {
        color: #555;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }
      .form-group {
        margin: 15px 0;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      button {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .result {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        margin-top: 15px;
        white-space: pre-wrap;
        font-family: monospace;
        max-height: 400px;
        overflow-y: auto;
      }
      .error {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
      }
      .success {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
      }
      .visibility-option {
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
      }
      .visibility-option:hover {
        background: #f0f0f0;
      }
      .visibility-option.selected {
        background: #e3f2fd;
        border-color: #2196f3;
      }
      .description {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîí Lead Visibility Groups - Testing Interface</h1>

      <!-- Authentication Section -->
      <div class="section">
        <h2>üîë Authentication</h2>
        <div class="form-group">
          <label>JWT Token:</label>
          <input
            type="text"
            id="token"
            placeholder="Enter your JWT token"
            value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDAsImVtYWlsIjoidmVybWFtcmlkdWw2NDFAZ21haWwuY29tIiwibG9naW5UeXBlIjoiYWRtaW4iLCJpYXQiOjE3NTMwODAwNzYsImV4cCI6MTc1NTY3MjA3Nn0.qxt0s2HAs33MsluRL7qTpk0yFfMgnBmVUtr0YNk2cZg"
          />
        </div>
        <button onclick="getVisibilityOptions()">
          üîç Get Visibility Options
        </button>
      </div>

      <!-- Visibility Options Section -->
      <div class="section">
        <h2>üëÅÔ∏è Visibility Options</h2>
        <div id="visibilityOptions"></div>
        <div id="optionsResult" class="result" style="display: none"></div>
      </div>

      <!-- Create Lead Section -->
      <div class="section">
        <h2>‚ûï Create Lead with Visibility</h2>
        <div class="form-group">
          <label>Contact Person:</label>
          <input type="text" id="contactPerson" value="John Doe" />
        </div>
        <div class="form-group">
          <label>Organization:</label>
          <input type="text" id="organization" value="Test Company Ltd" />
        </div>
        <div class="form-group">
          <label>Title:</label>
          <input type="text" id="title" value="Website Development Project" />
        </div>
        <div class="form-group">
          <label>Email:</label>
          <input type="email" id="email" value="john.doe@testcompany.com" />
        </div>
        <div class="form-group">
          <label>Phone:</label>
          <input type="text" id="phone" value="+1234567890" />
        </div>
        <div class="form-group">
          <label>Proposal Value:</label>
          <input type="number" id="proposalValue" value="50000" />
        </div>
        <div class="form-group">
          <label>Visibility Level:</label>
          <select id="visibilityLevel">
            <option value="item_owners_visibility_group">
              Item owner's visibility group (Default)
            </option>
            <option value="owner_only">Item owner only</option>
            <option value="group_only">Group and sub-groups</option>
            <option value="everyone">All users</option>
          </select>
        </div>
        <button onclick="createLead()">‚ûï Create Lead</button>
        <div id="createResult" class="result" style="display: none"></div>
      </div>

      <!-- Get Leads Section -->
      <div class="section">
        <h2>üìã Get Leads (with Visibility Filtering)</h2>
        <div class="form-group">
          <label>Page:</label>
          <input type="number" id="page" value="1" min="1" />
        </div>
        <div class="form-group">
          <label>Limit:</label>
          <input type="number" id="limit" value="10" min="1" max="100" />
        </div>
        <button onclick="getLeads()">üìã Get Leads</button>
        <div id="leadsResult" class="result" style="display: none"></div>
      </div>

      <!-- Test Various Scenarios -->
      <div class="section">
        <h2>üß™ Test Scenarios</h2>
        <button onclick="testOwnerOnlyLead()">üîí Test Owner Only Lead</button>
        <button onclick="testGroupLead()">üë• Test Group Visibility Lead</button>
        <button onclick="testEveryoneLead()">üåç Test Public Lead</button>
        <div id="testResult" class="result" style="display: none"></div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:3056/api";
      let currentVisibilityOptions = [];

      function getAuthHeaders() {
        const token = document.getElementById("token").value;
        return {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        };
      }

      async function getVisibilityOptions() {
        try {
          const response = await fetch(`${API_BASE}/leads/visibility-options`, {
            method: "GET",
            headers: getAuthHeaders(),
          });

          const data = await response.json();

          if (response.ok) {
            currentVisibilityOptions = data.options;
            displayVisibilityOptions(data);
            showResult(
              "optionsResult",
              JSON.stringify(data, null, 2),
              "success"
            );
          } else {
            showResult("optionsResult", `Error: ${data.message}`, "error");
          }
        } catch (error) {
          showResult("optionsResult", `Error: ${error.message}`, "error");
        }
      }

      function displayVisibilityOptions(data) {
        const container = document.getElementById("visibilityOptions");
        container.innerHTML = "";

        if (data.options && data.options.length > 0) {
          data.options.forEach((option) => {
            const div = document.createElement("div");
            div.className = "visibility-option";
            if (option.default) div.classList.add("selected");

            div.innerHTML = `
                        <strong>${option.label}</strong>
                        <div class="description">${option.description}</div>
                    `;

            div.onclick = () => {
              document
                .querySelectorAll(".visibility-option")
                .forEach((el) => el.classList.remove("selected"));
              div.classList.add("selected");
              document.getElementById("visibilityLevel").value = option.value;
            };

            container.appendChild(div);
          });
        } else {
          container.innerHTML = "<p>No visibility options available</p>";
        }
      }

      async function createLead() {
        const leadData = {
          contactPerson: document.getElementById("contactPerson").value,
          organization: document.getElementById("organization").value,
          title: document.getElementById("title").value,
          email: document.getElementById("email").value,
          phone: document.getElementById("phone").value,
          proposalValue: parseFloat(
            document.getElementById("proposalValue").value
          ),
          visibilityLevel: document.getElementById("visibilityLevel").value,
        };

        try {
          const response = await fetch(`${API_BASE}/leads/create`, {
            method: "POST",
            headers: getAuthHeaders(),
            body: JSON.stringify(leadData),
          });

          const data = await response.json();

          if (response.ok) {
            showResult(
              "createResult",
              JSON.stringify(data, null, 2),
              "success"
            );
          } else {
            showResult("createResult", `Error: ${data.message}`, "error");
          }
        } catch (error) {
          showResult("createResult", `Error: ${error.message}`, "error");
        }
      }

      async function getLeads() {
        const page = document.getElementById("page").value;
        const limit = document.getElementById("limit").value;

        try {
          const response = await fetch(
            `${API_BASE}/leads/get?page=${page}&limit=${limit}`,
            {
              method: "GET",
              headers: getAuthHeaders(),
            }
          );

          const data = await response.json();

          if (response.ok) {
            showResult("leadsResult", JSON.stringify(data, null, 2), "success");
          } else {
            showResult("leadsResult", `Error: ${data.message}`, "error");
          }
        } catch (error) {
          showResult("leadsResult", `Error: ${error.message}`, "error");
        }
      }

      async function testOwnerOnlyLead() {
        const testLead = {
          contactPerson: "Private Contact",
          organization: "Private Company",
          title: "Private Project",
          email: "private@example.com",
          phone: "+9999999999",
          proposalValue: 25000,
          visibilityLevel: "owner_only",
        };

        await createTestLead(testLead, "Owner Only Lead");
      }

      async function testGroupLead() {
        const testLead = {
          contactPerson: "Group Contact",
          organization: "Group Company",
          title: "Group Project",
          email: "group@example.com",
          phone: "+8888888888",
          proposalValue: 75000,
          visibilityLevel: "item_owners_visibility_group",
        };

        await createTestLead(testLead, "Group Visibility Lead");
      }

      async function testEveryoneLead() {
        const testLead = {
          contactPerson: "Public Contact",
          organization: "Public Company",
          title: "Public Project",
          email: "public@example.com",
          phone: "+7777777777",
          proposalValue: 100000,
          visibilityLevel: "everyone",
        };

        await createTestLead(testLead, "Public Lead");
      }

      async function createTestLead(leadData, testName) {
        try {
          const response = await fetch(`${API_BASE}/leads/create`, {
            method: "POST",
            headers: getAuthHeaders(),
            body: JSON.stringify(leadData),
          });

          const data = await response.json();

          if (response.ok) {
            showResult(
              "testResult",
              `${testName} Created Successfully:\n${JSON.stringify(
                data,
                null,
                2
              )}`,
              "success"
            );
          } else {
            showResult(
              "testResult",
              `${testName} Failed:\n${data.message}`,
              "error"
            );
          }
        } catch (error) {
          showResult(
            "testResult",
            `${testName} Error:\n${error.message}`,
            "error"
          );
        }
      }

      function showResult(elementId, content, type = "") {
        const element = document.getElementById(elementId);
        element.textContent = content;
        element.style.display = "block";
        element.className = `result ${type}`;
      }

      // Load visibility options on page load
      window.onload = function () {
        if (document.getElementById("token").value) {
          getVisibilityOptions();
        }
      };
    </script>
  </body>
</html>
