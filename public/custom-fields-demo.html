<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRM Custom Fields Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }

      .section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      .section h2 {
        color: #555;
        margin-top: 0;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      button {
        background-color: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }

      button:hover {
        background-color: #45a049;
      }

      .btn-secondary {
        background-color: #008cba;
      }

      .btn-secondary:hover {
        background-color: #007aa3;
      }

      .btn-danger {
        background-color: #f44336;
      }

      .btn-danger:hover {
        background-color: #da190b;
      }

      .custom-field-item {
        padding: 15px;
        border: 1px solid #eee;
        margin-bottom: 10px;
        border-radius: 4px;
        background-color: #fafafa;
      }

      .custom-field-item h4 {
        margin: 0 0 10px 0;
        color: #333;
      }

      .field-actions {
        margin-top: 10px;
      }

      .field-actions button {
        margin-right: 5px;
        padding: 5px 10px;
        font-size: 12px;
      }

      .api-example {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 4px;
        margin-top: 20px;
      }

      .api-example pre {
        background-color: #eee;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéØ CRM Custom Fields Management</h1>

      <!-- Create Custom Field Section -->
      <div class="section">
        <h2>üìù Create New Custom Field</h2>
        <form id="createFieldForm">
          <div class="form-group">
            <label for="fieldName">Field Name (Internal):</label>
            <input
              type="text"
              id="fieldName"
              name="fieldName"
              placeholder="e.g., project_budget"
              required
            />
          </div>

          <div class="form-group">
            <label for="fieldLabel">Field Label (Display):</label>
            <input
              type="text"
              id="fieldLabel"
              name="fieldLabel"
              placeholder="e.g., Project Budget"
              required
            />
          </div>

          <div class="form-group">
            <label for="fieldType">Field Type:</label>
            <select id="fieldType" name="fieldType" required>
              <option value="text">Text</option>
              <option value="textarea">Textarea</option>
              <option value="number">Number</option>
              <option value="decimal">Decimal</option>
              <option value="email">Email</option>
              <option value="phone">Phone</option>
              <option value="url">URL</option>
              <option value="date">Date</option>
              <option value="datetime">Date & Time</option>
              <option value="select">Select (Single)</option>
              <option value="multiselect">Multi-Select</option>
              <option value="checkbox">Checkbox</option>
              <option value="radio">Radio Button</option>
              <option value="currency">Currency</option>
            </select>
          </div>

          <div class="form-group">
            <label for="entityType">Entity Type:</label>
            <select id="entityType" name="entityType" required>
              <option value="lead">Lead</option>
              <option value="deal">Deal</option>
              <option value="person">Person</option>
              <option value="organization">Organization</option>
              <option value="activity">Activity</option>
            </select>
          </div>

          <div class="form-group" id="optionsGroup" style="display: none">
            <label for="options">Options (for select/radio fields):</label>
            <textarea
              id="options"
              name="options"
              placeholder="Option 1&#10;Option 2&#10;Option 3"
              rows="3"
            ></textarea>
            <small>Enter one option per line</small>
          </div>

          <div class="form-group">
            <label for="category">Category:</label>
            <select id="category" name="category">
              <option value="Summary">Summary</option>
              <option value="Details">Details</option>
              <option value="Financial">Financial</option>
              <option value="Contact">Contact</option>
              <option value="Custom">Custom</option>
            </select>
          </div>

          <div class="form-group">
            <label for="description">Description:</label>
            <textarea
              id="description"
              name="description"
              placeholder="Field description..."
              rows="2"
            ></textarea>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="isRequired" name="isRequired" />
              Required Field
            </label>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="isImportant" name="isImportant" />
              Important Field
            </label>
          </div>

          <button type="submit">Create Custom Field</button>
        </form>
      </div>

      <!-- Existing Custom Fields Section -->
      <div class="section">
        <h2>üìã Existing Custom Fields</h2>
        <div class="form-group">
          <label for="filterEntity">Filter by Entity Type:</label>
          <select id="filterEntity">
            <option value="">All Types</option>
            <option value="lead">Leads</option>
            <option value="deal">Deals</option>
            <option value="person">Persons</option>
            <option value="organization">Organizations</option>
            <option value="activity">Activities</option>
          </select>
        </div>

        <button onclick="loadCustomFields()" class="btn-secondary">
          Refresh Fields
        </button>

        <div id="customFieldsList"></div>
      </div>

      <!-- API Examples Section -->
      <div class="section">
        <h2>üöÄ API Usage Examples</h2>

        <h3>1. Create a Lead with Custom Fields</h3>
        <div class="api-example">
          <pre>
POST /api/leads
Content-Type: application/json

{
  "contactPerson": "John Doe",
  "organization": "Acme Corp",
  "title": "Website Redesign Project",
  "email": "john@acme.com",
  "phone": "+1-555-0123",
  "customFields": {
    "1": "High Priority",
    "2": "50000",
    "3": "2024-12-31"
  }
}
                </pre
          >
        </div>

        <h3>2. Create a Deal with Custom Fields</h3>
        <div class="api-example">
          <pre>
POST /api/deals
Content-Type: application/json

{
  "title": "Enterprise Software Deal",
  "contactPerson": "Jane Smith",
  "organization": "Tech Solutions Inc",
  "email": "jane@techsolutions.com",
  "phone": "+1-555-0456",
  "value": 75000,
  "customFields": {
    "4": "Q1 2024",
    "5": "Enterprise",
    "6": "Direct Sales"
  }
}
                </pre
          >
        </div>

        <h3>3. Get Custom Fields for Entity</h3>
        <div class="api-example">
          <pre>
GET /api/custom-fields?entityType=lead
                </pre
          >
        </div>

        <h3>4. Update Custom Field Values</h3>
        <div class="api-example">
          <pre>
PUT /api/custom-fields/values/lead/123
Content-Type: application/json

{
  "fieldValues": {
    "1": "Updated Priority",
    "2": "60000"
  }
}
                </pre
          >
        </div>
      </div>
    </div>

    <script>
      // Handle field type change to show/hide options
      document
        .getElementById("fieldType")
        .addEventListener("change", function () {
          const optionsGroup = document.getElementById("optionsGroup");
          const requiresOptions = ["select", "multiselect", "radio"].includes(
            this.value
          );
          optionsGroup.style.display = requiresOptions ? "block" : "none";
        });

      // Handle form submission
      document
        .getElementById("createFieldForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          const data = Object.fromEntries(formData);

          // Process options if they exist
          if (data.options) {
            data.options = data.options
              .split("\n")
              .map((opt) => opt.trim())
              .filter((opt) => opt);
          }

          // Convert checkboxes to booleans
          data.isRequired = formData.has("isRequired");
          data.isImportant = formData.has("isImportant");

          console.log("Creating custom field:", data);
          alert(
            "Custom field would be created with:\n" +
              JSON.stringify(data, null, 2)
          );

          // In a real implementation, you would make an API call here:
          // fetch('/api/custom-fields', {
          //     method: 'POST',
          //     headers: { 'Content-Type': 'application/json' },
          //     body: JSON.stringify(data)
          // });
        });

      // Load custom fields function
      function loadCustomFields() {
        const entityFilter = document.getElementById("filterEntity").value;
        const container = document.getElementById("customFieldsList");

        // Mock data - in real implementation, this would come from API
        const mockFields = [
          {
            fieldId: 1,
            fieldName: "project_priority",
            fieldLabel: "Project Priority",
            fieldType: "select",
            entityType: "lead",
            category: "Summary",
            isRequired: true,
            isImportant: true,
            options: ["High", "Medium", "Low"],
          },
          {
            fieldId: 2,
            fieldName: "budget_range",
            fieldLabel: "Budget Range",
            fieldType: "currency",
            entityType: "lead",
            category: "Financial",
            isRequired: false,
            isImportant: true,
          },
          {
            fieldId: 3,
            fieldName: "deal_source",
            fieldLabel: "Deal Source",
            fieldType: "select",
            entityType: "deal",
            category: "Details",
            isRequired: false,
            isImportant: false,
            options: ["Website", "Referral", "Cold Call", "Email Campaign"],
          },
        ];

        // Filter fields if entity type is selected
        const filteredFields = entityFilter
          ? mockFields.filter((field) => field.entityType === entityFilter)
          : mockFields;

        container.innerHTML = "";

        if (filteredFields.length === 0) {
          container.innerHTML = "<p>No custom fields found.</p>";
          return;
        }

        filteredFields.forEach((field) => {
          const fieldDiv = document.createElement("div");
          fieldDiv.className = "custom-field-item";
          fieldDiv.innerHTML = `
                    <h4>${field.fieldLabel} (${field.fieldName})</h4>
                    <p><strong>Type:</strong> ${field.fieldType}</p>
                    <p><strong>Entity:</strong> ${field.entityType}</p>
                    <p><strong>Category:</strong> ${field.category}</p>
                    <p><strong>Required:</strong> ${
                      field.isRequired ? "Yes" : "No"
                    }</p>
                    <p><strong>Important:</strong> ${
                      field.isImportant ? "Yes" : "No"
                    }</p>
                    ${
                      field.options
                        ? `<p><strong>Options:</strong> ${field.options.join(
                            ", "
                          )}</p>`
                        : ""
                    }
                    <div class="field-actions">
                        <button onclick="editField(${
                          field.fieldId
                        })" class="btn-secondary">Edit</button>
                        <button onclick="deleteField(${
                          field.fieldId
                        })" class="btn-danger">Delete</button>
                    </div>
                `;
          container.appendChild(fieldDiv);
        });
      }

      function editField(fieldId) {
        alert(`Edit field ${fieldId} - This would open an edit form`);
      }

      function deleteField(fieldId) {
        if (confirm(`Are you sure you want to delete field ${fieldId}?`)) {
          alert(`Field ${fieldId} would be deleted`);
          loadCustomFields(); // Refresh the list
        }
      }

      // Load fields on page load
      window.addEventListener("load", loadCustomFields);
    </script>
  </body>
</html>
