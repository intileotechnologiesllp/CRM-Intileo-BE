# Meetings Table Verification Guide

## Overview

The SQL you shared shows the table structure generated by Sequelize. This document explains the differences and verifies correctness.

## Sequelize vs Migration SQL Differences

### 1. BOOLEAN → TINYINT(1)

**Migration File:**
```sql
`sendInvites` BOOLEAN NOT NULL DEFAULT TRUE
`followUpRequired` BOOLEAN NOT NULL DEFAULT FALSE
```

**Sequelize Generated:**
```sql
`sendInvites` TINYINT(1) NOT NULL DEFAULT true
`followUpRequired` TINYINT(1) NOT NULL DEFAULT false
```

**Status:** ✅ **Normal** - MySQL doesn't have native BOOLEAN type. Sequelize correctly maps it to TINYINT(1), which is the standard way to represent booleans in MySQL.

### 2. Indexes

**Migration File:**
```sql
UNIQUE KEY `unique_activityId` (`activityId`),
KEY `idx_meetingStatus` (`meetingStatus`),
KEY `idx_masterUserID` (`masterUserID`),
KEY `idx_icsUid` (`icsUid`),
```

**Sequelize Generated:**
- Primary key index (always created)
- Unique constraint on `activityId` (created)
- Foreign key indexes (may be created automatically)
- Other indexes defined in model may be created separately

**Status:** ⚠️ **Check** - Verify indexes exist using `SHOW INDEXES FROM Meetings;`

### 3. Foreign Key Constraints

**Migration File:**
```sql
CONSTRAINT `fk_meeting_activity` FOREIGN KEY (`activityId`) REFERENCES `Activities` (`activityId`) ON DELETE CASCADE,
CONSTRAINT `fk_meeting_owner` FOREIGN KEY (`masterUserID`) REFERENCES `masterusers` (`masterUserID`) ON DELETE CASCADE,
CONSTRAINT `fk_meeting_cancelledBy` FOREIGN KEY (`cancelledBy`) REFERENCES `masterusers` (`masterUserID`) ON DELETE SET NULL
```

**Sequelize Generated:**
```sql
FOREIGN KEY (`activityId`) REFERENCES `Activities` (`activityId`) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (`cancelledBy`) REFERENCES `masterusers` (`masterUserID`) ON DELETE SET NULL ON UPDATE CASCADE,
FOREIGN KEY (`masterUserID`) REFERENCES `masterusers` (`masterUserID`) ON DELETE CASCADE ON UPDATE CASCADE
```

**Status:** ✅ **Good** - Sequelize added `ON UPDATE CASCADE` which is actually beneficial for referential integrity.

### 4. Default Values for Timestamps

**Migration File:**
```sql
`createdAt` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
`updatedAt` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
```

**Sequelize Generated:**
```sql
`createdAt` DATETIME NOT NULL,
`updatedAt` DATETIME NOT NULL,
```

**Status:** ⚠️ **Note** - Sequelize handles timestamps in application code. The defaults may be set at the application level, not database level. This is fine if you're using Sequelize's hooks.

## Verification Checklist

Run these queries to verify your table structure:

### 1. Check Table Structure

```sql
DESCRIBE `Meetings`;
```

Expected columns:
- ✅ meetingId (INT, PRIMARY KEY, AUTO_INCREMENT)
- ✅ activityId (INT, NOT NULL, UNIQUE)
- ✅ timezone (VARCHAR(100), DEFAULT 'UTC')
- ✅ meetingStatus (ENUM: scheduled, confirmed, cancelled, completed, no_show)
- ✅ recurrenceRule (TEXT, NULL)
- ✅ recurrenceEndDate (DATETIME, NULL)
- ✅ reminderMinutes (TEXT, NULL)
- ✅ meetingUrl (VARCHAR(500), NULL)
- ✅ organizerEmail (VARCHAR(255), NOT NULL)
- ✅ organizerName (VARCHAR(255), NOT NULL)
- ✅ icsUid (VARCHAR(255), NULL, UNIQUE)
- ✅ sendInvites (TINYINT(1), DEFAULT 1)
- ✅ lastSentAt (DATETIME, NULL)
- ✅ cancelledAt (DATETIME, NULL)
- ✅ cancelledBy (INT, NULL)
- ✅ cancellationReason (TEXT, NULL)
- ✅ externalAttendees (TEXT, NULL)
- ✅ meetingNotes (TEXT, NULL)
- ✅ followUpRequired (TINYINT(1), DEFAULT 0)
- ✅ masterUserID (INT, NOT NULL)
- ✅ createdAt (DATETIME, NOT NULL)
- ✅ updatedAt (DATETIME, NOT NULL)

### 2. Verify Indexes

```sql
SHOW INDEXES FROM `Meetings`;
```

Expected indexes:
- ✅ PRIMARY on `meetingId`
- ✅ UNIQUE on `activityId`
- ✅ INDEX on `meetingStatus` (if defined in model)
- ✅ INDEX on `masterUserID` (if defined in model)
- ✅ INDEX on `icsUid` (if defined in model)

### 3. Verify Foreign Keys

```sql
SELECT 
  CONSTRAINT_NAME,
  COLUMN_NAME,
  REFERENCED_TABLE_NAME,
  REFERENCED_COLUMN_NAME,
  DELETE_RULE,
  UPDATE_RULE
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE TABLE_SCHEMA = DATABASE()
  AND TABLE_NAME = 'Meetings'
  AND REFERENCED_TABLE_NAME IS NOT NULL;
```

Expected foreign keys:
- ✅ `activityId` → `Activities.activityId` (ON DELETE CASCADE)
- ✅ `masterUserID` → `masterusers.masterUserID` (ON DELETE CASCADE)
- ✅ `cancelledBy` → `masterusers.masterUserID` (ON DELETE SET NULL)

### 4. Verify ENUM Values

```sql
SHOW COLUMNS FROM `Meetings` WHERE FIELD = 'meetingStatus';
```

Expected ENUM values: `'scheduled', 'confirmed', 'cancelled', 'completed', 'no_show'`

## If Indexes Are Missing

If the indexes from the migration file are missing, add them manually:

```sql
-- Add indexes if missing
CREATE INDEX `idx_meetingStatus` ON `Meetings` (`meetingStatus`);
CREATE INDEX `idx_masterUserID` ON `Meetings` (`masterUserID`);
CREATE INDEX `idx_icsUid` ON `Meetings` (`icsUid`);
```

## If You Want Exact Migration Structure

If you want the exact structure from the migration file (including named constraints and all indexes), run the SQL migration directly:

```sql
SOURCE migrations/create-meetings-table.sql;
```

This will create the table with all named constraints and indexes as specified.

## Summary

✅ **Your table structure is correct!** 

The differences are normal Sequelize behavior:
- BOOLEAN → TINYINT(1) is standard MySQL mapping
- ON UPDATE CASCADE is actually beneficial
- Indexes may need manual verification/addition
- Timestamps are handled by Sequelize hooks (which is fine)

The table should work correctly with the application code as written.

